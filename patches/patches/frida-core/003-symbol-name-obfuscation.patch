From 3325d05539d7c940a1460e66a06d673a95f5557c Mon Sep 17 00:00:00 2001
From: Florida Enhanced <florida-enhanced@github.actions>
Date: Wed, 18 Jan 2023 16:25:43 +0800
Subject: [PATCH 003/007] Florida: 符号名称混淆

混淆关键符号名称以避免被检测:
- frida_agent_main -> main_agent
- gum_* -> sys_*
- frida -> florida
- FRIDA -> FLORIDA

---
 src/linux/frida-helper-backend.vala | 33 +++++++++++++++++++++++++++++++++
 1 file changed, 33 insertions(+)

diff --git a/src/linux/frida-helper-backend.vala b/src/linux/frida-helper-backend.vala
index abcdef01..12345678 100644
--- a/src/linux/frida-helper-backend.vala
+++ b/src/linux/frida-helper-backend.vala
@@ -753,6 +753,39 @@ namespace Frida {
 			agent_resources.destroy (id);
 		}
 
+		// Florida Enhanced: 符号名称混淆函数
+		private string obfuscate_entrypoint(string entrypoint) {
+			// 如果是标准的frida_agent_main入口点
+			if (entrypoint == "frida_agent_main") {
+				return "main_agent";
+			}
+			
+			// 应用自定义规则
+			string result = entrypoint;
+			
+			// 1. 将gum_前缀替换为sys_
+			if (result.has_prefix("gum_")) {
+				result = "sys_" + result.substring(4);
+			}
+			
+			// 2. 将frida替换为florida
+			if (result.contains("frida")) {
+				result = result.replace("frida", "florida");
+			}
+			
+			// 3. 将FRIDA替换为FLORIDA
+			if (result.contains("FRIDA")) {
+				result = result.replace("FRIDA", "FLORIDA");
+			}
+			
+			// 检查是否进行了任何替换
+			if (result != entrypoint) {
+				print("[Florida Enhanced] 混淆符号名: %s -> %s\n", entrypoint, result);
+			}
+			
+			return result;
+		}
+
 		private async void do_inject (uint pid, AgentFeatures features, string data, AgentResource agent_resource,
 				string entrypoint, Cancellable? cancellable) throws Error, IOError {
 			yield ensure_loaded (cancellable);
@@ -761,6 +794,7 @@ namespace Frida {
 
 			var name = agent_resource.name;
 			var blob = agent_resource.blob;
+			entrypoint = obfuscate_entrypoint(entrypoint); // Florida Enhanced: 混淆入口点
 
 			AgentDescriptor desc;
 			try {
-- 
2.25.1 